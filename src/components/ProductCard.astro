---
import { Image } from 'astro:assets';
const { product } = Astro.props;
const galleryJson = JSON.stringify(product?.galleryImages || []);
---
<div class="product-trigger card"
     data-id={product?.id}
     data-name={product?.name}
     data-description={product?.description}
     data-price={product?.price}
     data-images={galleryJson}
     data-min-quantity={product?.minQuantity}
     tabindex="0"
     role="button"
>
  <div class="card-media">
    <Image 
      src={product.image} 
      alt={product.name} 
      class="product-img"
      widths={[250, 400]}
      sizes="(max-width: 768px) 400px, 250px"
      format="webp" 
    />
  </div>
  <div class="card-content">
    <h3>{product?.name}</h3>
    <p class="desc">{product?.description}</p>
    <div class="price-row">
      <span class="price">${product?.price}</span>
      <span class="min-qty">Mín. {product?.minQuantity}</span>
    </div>
  </div>
  <style>
    .card {
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 2px 12px #0002;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      /* Transición suave para el hover */
      transition: box-shadow 0.25s ease-out, transform 0.25s ease-out;
      cursor: pointer;
      border: none;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .card:hover {
      box-shadow: 0 4px 24px #0003;
      transform: translateY(-4px) scale(1.02); /* Ajuste leve para ser más sutil */
    }
    .card-media {
      aspect-ratio: 4 / 5;
      background: #faf6f4;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    .product-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }
    .card-content {
      width: 100%;
      text-align: center;
      padding: 1rem;
    }

    h3 {
      height: 2.9em;
      line-height: 1.45;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      margin-top: 0;
      margin-bottom: 0.5rem;
    }
    .desc {
      color: #7c4d2a;
      font-size: 0.95rem;
      margin: 0.5rem 0 1rem 0;
      /* Establece una altura fija para 2 líneas y trunca */
      height: 2.9em; /* Ajusta este valor (font-size * line-height * 2) */
      line-height: 1.45;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    /* --- FIN DE ESTILOS MODIFICADOS --- */

    .price-row {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      font-size: 1.1rem;
      margin-top: 0.5rem;
    }
    .price {
      color: var(--primary);
      font-weight: bold;
    }
    .min-qty {
      color: var(--accent);
      font-size: 0.95em;
    }
  </style>
</div>